SRCS_FOLDER   = sources
GEN_FOLDER    = build
PARSE_FOLDER  = parse

INTRFC_FILES  = parse.mli
SRCS_FILES    = ast.ml utils.ml print.ml eval.ml compile.ml parse.ml lex.ml main.ml
GEN_FILES     = lex.ml parse.ml parse.mli parse.automaton parse.conflicts

INTERFACES    = $(addprefix $(SRCS_FOLDER)/, $(INTRFC_FILES))
SOURCES       = $(addprefix $(SRCS_FOLDER)/, $(SRCS_FILES))
GENERATED     = $(addprefix $(GEN_FOLDER)/, $(GEN_FILES))

all: $(SRCS_FOLDER)/parse.mli $(SOURCES)
	ocamlc -c $(SRCS_FOLDER)/ast.ml
	ocamlc $(INTERFACES)
	ocamlc -o compiler $(SOURCES)

testLex: parse.mli lex.ml testLex.ml utils.ml
	ocamlc -c ast.ml
	ocamlc $(INTERFACES)
	ocamlc -o testLex ast.ml utils.ml lex.ml testLex.ml

lex.ml: lex.mll parse.mli ast.ml
	ocamllex lex.mll

$(SRCS_FOLDER)/parse.mli: parse.mly ast.ml
	menhir --dump --explain --strict parse.mly

clean:
	rm -rf compiler testLex *.o *.cmi *.cmo *.cmx *~ $(GENERATED)
